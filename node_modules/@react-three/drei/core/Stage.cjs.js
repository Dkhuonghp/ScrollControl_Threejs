"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),t=require("three"),r=require("@react-three/fiber"),n=require("./Environment.cjs.js"),i=require("./ContactShadows.cjs.js");function a(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(r){if("default"!==r){var n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return e[r]}})}})),t.default=e,Object.freeze(t)}require("three-stdlib"),require("use-asset"),require("../helpers/environment-assets.cjs.js"),require("@babel/runtime/helpers/extends");var o=a(e),s=a(t);const u={rembrandt:{main:[1,2,1],fill:[-2,-.5,-2]},portrait:{main:[-1,2,.5],fill:[-1,.5,-1.5]},upfront:{main:[0,2,1],fill:[-1,.5,-1.5]},soft:{main:[-2,4,4],fill:[-1,.5,-1.5]}};exports.Stage=function({children:e,controls:t,shadows:a=!0,adjustCamera:c=!0,environment:l="city",contactShadow:h=!0,intensity:d=1,preset:f="rembrandt",shadowBias:m=0,contactShadowBlur:p=2,contactShadowOpacity:b=.5,...g}){const w=u[f],y=r.useThree((e=>e.camera)),j=r.useThree((e=>e.controls)),E=o.useRef(null),x=o.useRef(null),[{radius:v,width:S,height:q},O]=o.useState({radius:0,width:0,height:0});return o.useLayoutEffect((()=>{E.current.position.set(0,0,0),E.current.updateWorldMatrix(!0,!0);const e=(new s.Box3).setFromObject(x.current),t=new s.Vector3,r=new s.Sphere,n=e.max.y-e.min.y,i=e.max.x-e.min.x;e.getCenter(t),e.getBoundingSphere(r),O({radius:r.radius,width:i,height:n}),E.current.position.set(-t.x,-t.y+n/2,-t.z)}),[e]),o.useLayoutEffect((()=>{if(c){const e=v/(q>S?1.5:2.5);y.position.set(0,.5*v,2.5*v),y.near=.1,y.far=Math.max(5e3,4*v),y.lookAt(0,e,0);const r=j||(null==t?void 0:t.current);r&&(r.target.set(0,e,0),r.update())}}),[j,v,q,S,c]),o.createElement("group",g,o.createElement("group",{ref:E},o.createElement("group",{ref:x},e)),h&&o.createElement(i.ContactShadows,{"rotation-x":Math.PI/2,opacity:b,width:2*v,height:2*v,blur:p,far:v/2}),l&&o.createElement(n.Environment,{preset:l}),o.createElement("ambientLight",{intensity:d/3}),o.createElement("spotLight",{penumbra:1,position:[w.main[0]*v,w.main[1]*v,w.main[2]*v],intensity:2*d,castShadow:a,"shadow-bias":m}),o.createElement("pointLight",{position:[w.fill[0]*v,w.fill[1]*v,w.fill[2]*v],intensity:d}))};
