{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n\n    _extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.serializeProduction = exports.serializeGrammar = exports.Terminal = exports.Alternation = exports.RepetitionWithSeparator = exports.Repetition = exports.RepetitionMandatoryWithSeparator = exports.RepetitionMandatory = exports.Option = exports.Alternative = exports.Rule = exports.NonTerminal = exports.AbstractProduction = void 0;\n\nvar map_1 = __importDefault(require(\"lodash/map\"));\n\nvar forEach_1 = __importDefault(require(\"lodash/forEach\"));\n\nvar isString_1 = __importDefault(require(\"lodash/isString\"));\n\nvar isRegExp_1 = __importDefault(require(\"lodash/isRegExp\"));\n\nvar pickBy_1 = __importDefault(require(\"lodash/pickBy\"));\n\nvar assign_1 = __importDefault(require(\"lodash/assign\")); // TODO: duplicated code to avoid extracting another sub-package -- how to avoid?\n\n\nfunction tokenLabel(tokType) {\n  if (hasTokenLabel(tokType)) {\n    return tokType.LABEL;\n  } else {\n    return tokType.name;\n  }\n} // TODO: duplicated code to avoid extracting another sub-package -- how to avoid?\n\n\nfunction hasTokenLabel(obj) {\n  return (0, isString_1.default)(obj.LABEL) && obj.LABEL !== \"\";\n}\n\nvar AbstractProduction =\n/** @class */\nfunction () {\n  function AbstractProduction(_definition) {\n    this._definition = _definition;\n  }\n\n  Object.defineProperty(AbstractProduction.prototype, \"definition\", {\n    get: function get() {\n      return this._definition;\n    },\n    set: function set(value) {\n      this._definition = value;\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  AbstractProduction.prototype.accept = function (visitor) {\n    visitor.visit(this);\n    (0, forEach_1.default)(this.definition, function (prod) {\n      prod.accept(visitor);\n    });\n  };\n\n  return AbstractProduction;\n}();\n\nexports.AbstractProduction = AbstractProduction;\n\nvar NonTerminal =\n/** @class */\nfunction (_super) {\n  __extends(NonTerminal, _super);\n\n  function NonTerminal(options) {\n    var _this = _super.call(this, []) || this;\n\n    _this.idx = 1;\n    (0, assign_1.default)(_this, (0, pickBy_1.default)(options, function (v) {\n      return v !== undefined;\n    }));\n    return _this;\n  }\n\n  Object.defineProperty(NonTerminal.prototype, \"definition\", {\n    get: function get() {\n      if (this.referencedRule !== undefined) {\n        return this.referencedRule.definition;\n      }\n\n      return [];\n    },\n    set: function set(definition) {// immutable\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  NonTerminal.prototype.accept = function (visitor) {\n    visitor.visit(this); // don't visit children of a reference, we will get cyclic infinite loops if we do so\n  };\n\n  return NonTerminal;\n}(AbstractProduction);\n\nexports.NonTerminal = NonTerminal;\n\nvar Rule =\n/** @class */\nfunction (_super) {\n  __extends(Rule, _super);\n\n  function Rule(options) {\n    var _this = _super.call(this, options.definition) || this;\n\n    _this.orgText = \"\";\n    (0, assign_1.default)(_this, (0, pickBy_1.default)(options, function (v) {\n      return v !== undefined;\n    }));\n    return _this;\n  }\n\n  return Rule;\n}(AbstractProduction);\n\nexports.Rule = Rule;\n\nvar Alternative =\n/** @class */\nfunction (_super) {\n  __extends(Alternative, _super);\n\n  function Alternative(options) {\n    var _this = _super.call(this, options.definition) || this;\n\n    _this.ignoreAmbiguities = false;\n    (0, assign_1.default)(_this, (0, pickBy_1.default)(options, function (v) {\n      return v !== undefined;\n    }));\n    return _this;\n  }\n\n  return Alternative;\n}(AbstractProduction);\n\nexports.Alternative = Alternative;\n\nvar Option =\n/** @class */\nfunction (_super) {\n  __extends(Option, _super);\n\n  function Option(options) {\n    var _this = _super.call(this, options.definition) || this;\n\n    _this.idx = 1;\n    (0, assign_1.default)(_this, (0, pickBy_1.default)(options, function (v) {\n      return v !== undefined;\n    }));\n    return _this;\n  }\n\n  return Option;\n}(AbstractProduction);\n\nexports.Option = Option;\n\nvar RepetitionMandatory =\n/** @class */\nfunction (_super) {\n  __extends(RepetitionMandatory, _super);\n\n  function RepetitionMandatory(options) {\n    var _this = _super.call(this, options.definition) || this;\n\n    _this.idx = 1;\n    (0, assign_1.default)(_this, (0, pickBy_1.default)(options, function (v) {\n      return v !== undefined;\n    }));\n    return _this;\n  }\n\n  return RepetitionMandatory;\n}(AbstractProduction);\n\nexports.RepetitionMandatory = RepetitionMandatory;\n\nvar RepetitionMandatoryWithSeparator =\n/** @class */\nfunction (_super) {\n  __extends(RepetitionMandatoryWithSeparator, _super);\n\n  function RepetitionMandatoryWithSeparator(options) {\n    var _this = _super.call(this, options.definition) || this;\n\n    _this.idx = 1;\n    (0, assign_1.default)(_this, (0, pickBy_1.default)(options, function (v) {\n      return v !== undefined;\n    }));\n    return _this;\n  }\n\n  return RepetitionMandatoryWithSeparator;\n}(AbstractProduction);\n\nexports.RepetitionMandatoryWithSeparator = RepetitionMandatoryWithSeparator;\n\nvar Repetition =\n/** @class */\nfunction (_super) {\n  __extends(Repetition, _super);\n\n  function Repetition(options) {\n    var _this = _super.call(this, options.definition) || this;\n\n    _this.idx = 1;\n    (0, assign_1.default)(_this, (0, pickBy_1.default)(options, function (v) {\n      return v !== undefined;\n    }));\n    return _this;\n  }\n\n  return Repetition;\n}(AbstractProduction);\n\nexports.Repetition = Repetition;\n\nvar RepetitionWithSeparator =\n/** @class */\nfunction (_super) {\n  __extends(RepetitionWithSeparator, _super);\n\n  function RepetitionWithSeparator(options) {\n    var _this = _super.call(this, options.definition) || this;\n\n    _this.idx = 1;\n    (0, assign_1.default)(_this, (0, pickBy_1.default)(options, function (v) {\n      return v !== undefined;\n    }));\n    return _this;\n  }\n\n  return RepetitionWithSeparator;\n}(AbstractProduction);\n\nexports.RepetitionWithSeparator = RepetitionWithSeparator;\n\nvar Alternation =\n/** @class */\nfunction (_super) {\n  __extends(Alternation, _super);\n\n  function Alternation(options) {\n    var _this = _super.call(this, options.definition) || this;\n\n    _this.idx = 1;\n    _this.ignoreAmbiguities = false;\n    _this.hasPredicates = false;\n    (0, assign_1.default)(_this, (0, pickBy_1.default)(options, function (v) {\n      return v !== undefined;\n    }));\n    return _this;\n  }\n\n  Object.defineProperty(Alternation.prototype, \"definition\", {\n    get: function get() {\n      return this._definition;\n    },\n    set: function set(value) {\n      this._definition = value;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  return Alternation;\n}(AbstractProduction);\n\nexports.Alternation = Alternation;\n\nvar Terminal =\n/** @class */\nfunction () {\n  function Terminal(options) {\n    this.idx = 1;\n    (0, assign_1.default)(this, (0, pickBy_1.default)(options, function (v) {\n      return v !== undefined;\n    }));\n  }\n\n  Terminal.prototype.accept = function (visitor) {\n    visitor.visit(this);\n  };\n\n  return Terminal;\n}();\n\nexports.Terminal = Terminal;\n\nfunction serializeGrammar(topRules) {\n  return (0, map_1.default)(topRules, serializeProduction);\n}\n\nexports.serializeGrammar = serializeGrammar;\n\nfunction serializeProduction(node) {\n  function convertDefinition(definition) {\n    return (0, map_1.default)(definition, serializeProduction);\n  }\n  /* istanbul ignore else */\n\n\n  if (node instanceof NonTerminal) {\n    var serializedNonTerminal = {\n      type: \"NonTerminal\",\n      name: node.nonTerminalName,\n      idx: node.idx\n    };\n\n    if ((0, isString_1.default)(node.label)) {\n      serializedNonTerminal.label = node.label;\n    }\n\n    return serializedNonTerminal;\n  } else if (node instanceof Alternative) {\n    return {\n      type: \"Alternative\",\n      definition: convertDefinition(node.definition)\n    };\n  } else if (node instanceof Option) {\n    return {\n      type: \"Option\",\n      idx: node.idx,\n      definition: convertDefinition(node.definition)\n    };\n  } else if (node instanceof RepetitionMandatory) {\n    return {\n      type: \"RepetitionMandatory\",\n      idx: node.idx,\n      definition: convertDefinition(node.definition)\n    };\n  } else if (node instanceof RepetitionMandatoryWithSeparator) {\n    return {\n      type: \"RepetitionMandatoryWithSeparator\",\n      idx: node.idx,\n      separator: serializeProduction(new Terminal({\n        terminalType: node.separator\n      })),\n      definition: convertDefinition(node.definition)\n    };\n  } else if (node instanceof RepetitionWithSeparator) {\n    return {\n      type: \"RepetitionWithSeparator\",\n      idx: node.idx,\n      separator: serializeProduction(new Terminal({\n        terminalType: node.separator\n      })),\n      definition: convertDefinition(node.definition)\n    };\n  } else if (node instanceof Repetition) {\n    return {\n      type: \"Repetition\",\n      idx: node.idx,\n      definition: convertDefinition(node.definition)\n    };\n  } else if (node instanceof Alternation) {\n    return {\n      type: \"Alternation\",\n      idx: node.idx,\n      definition: convertDefinition(node.definition)\n    };\n  } else if (node instanceof Terminal) {\n    var serializedTerminal = {\n      type: \"Terminal\",\n      name: node.terminalType.name,\n      label: tokenLabel(node.terminalType),\n      idx: node.idx\n    };\n\n    if ((0, isString_1.default)(node.label)) {\n      serializedTerminal.terminalLabel = node.label;\n    }\n\n    var pattern = node.terminalType.PATTERN;\n\n    if (node.terminalType.PATTERN) {\n      serializedTerminal.pattern = (0, isRegExp_1.default)(pattern) ? pattern.source : pattern;\n    }\n\n    return serializedTerminal;\n  } else if (node instanceof Rule) {\n    return {\n      type: \"Rule\",\n      name: node.name,\n      orgText: node.orgText,\n      definition: convertDefinition(node.definition)\n    };\n  } else {\n    throw Error(\"non exhaustive match\");\n  }\n}\n\nexports.serializeProduction = serializeProduction;","map":{"version":3,"sources":["../../src/model.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.serializeProduction = exports.serializeGrammar = exports.Terminal = exports.Alternation = exports.RepetitionWithSeparator = exports.Repetition = exports.RepetitionMandatoryWithSeparator = exports.RepetitionMandatory = exports.Option = exports.Alternative = exports.Rule = exports.NonTerminal = exports.AbstractProduction = void 0;\nvar map_1 = __importDefault(require(\"lodash/map\"));\nvar forEach_1 = __importDefault(require(\"lodash/forEach\"));\nvar isString_1 = __importDefault(require(\"lodash/isString\"));\nvar isRegExp_1 = __importDefault(require(\"lodash/isRegExp\"));\nvar pickBy_1 = __importDefault(require(\"lodash/pickBy\"));\nvar assign_1 = __importDefault(require(\"lodash/assign\"));\n// TODO: duplicated code to avoid extracting another sub-package -- how to avoid?\nfunction tokenLabel(tokType) {\n    if (hasTokenLabel(tokType)) {\n        return tokType.LABEL;\n    }\n    else {\n        return tokType.name;\n    }\n}\n// TODO: duplicated code to avoid extracting another sub-package -- how to avoid?\nfunction hasTokenLabel(obj) {\n    return (0, isString_1.default)(obj.LABEL) && obj.LABEL !== \"\";\n}\nvar AbstractProduction = /** @class */ (function () {\n    function AbstractProduction(_definition) {\n        this._definition = _definition;\n    }\n    Object.defineProperty(AbstractProduction.prototype, \"definition\", {\n        get: function () {\n            return this._definition;\n        },\n        set: function (value) {\n            this._definition = value;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    AbstractProduction.prototype.accept = function (visitor) {\n        visitor.visit(this);\n        (0, forEach_1.default)(this.definition, function (prod) {\n            prod.accept(visitor);\n        });\n    };\n    return AbstractProduction;\n}());\nexports.AbstractProduction = AbstractProduction;\nvar NonTerminal = /** @class */ (function (_super) {\n    __extends(NonTerminal, _super);\n    function NonTerminal(options) {\n        var _this = _super.call(this, []) || this;\n        _this.idx = 1;\n        (0, assign_1.default)(_this, (0, pickBy_1.default)(options, function (v) { return v !== undefined; }));\n        return _this;\n    }\n    Object.defineProperty(NonTerminal.prototype, \"definition\", {\n        get: function () {\n            if (this.referencedRule !== undefined) {\n                return this.referencedRule.definition;\n            }\n            return [];\n        },\n        set: function (definition) {\n            // immutable\n        },\n        enumerable: false,\n        configurable: true\n    });\n    NonTerminal.prototype.accept = function (visitor) {\n        visitor.visit(this);\n        // don't visit children of a reference, we will get cyclic infinite loops if we do so\n    };\n    return NonTerminal;\n}(AbstractProduction));\nexports.NonTerminal = NonTerminal;\nvar Rule = /** @class */ (function (_super) {\n    __extends(Rule, _super);\n    function Rule(options) {\n        var _this = _super.call(this, options.definition) || this;\n        _this.orgText = \"\";\n        (0, assign_1.default)(_this, (0, pickBy_1.default)(options, function (v) { return v !== undefined; }));\n        return _this;\n    }\n    return Rule;\n}(AbstractProduction));\nexports.Rule = Rule;\nvar Alternative = /** @class */ (function (_super) {\n    __extends(Alternative, _super);\n    function Alternative(options) {\n        var _this = _super.call(this, options.definition) || this;\n        _this.ignoreAmbiguities = false;\n        (0, assign_1.default)(_this, (0, pickBy_1.default)(options, function (v) { return v !== undefined; }));\n        return _this;\n    }\n    return Alternative;\n}(AbstractProduction));\nexports.Alternative = Alternative;\nvar Option = /** @class */ (function (_super) {\n    __extends(Option, _super);\n    function Option(options) {\n        var _this = _super.call(this, options.definition) || this;\n        _this.idx = 1;\n        (0, assign_1.default)(_this, (0, pickBy_1.default)(options, function (v) { return v !== undefined; }));\n        return _this;\n    }\n    return Option;\n}(AbstractProduction));\nexports.Option = Option;\nvar RepetitionMandatory = /** @class */ (function (_super) {\n    __extends(RepetitionMandatory, _super);\n    function RepetitionMandatory(options) {\n        var _this = _super.call(this, options.definition) || this;\n        _this.idx = 1;\n        (0, assign_1.default)(_this, (0, pickBy_1.default)(options, function (v) { return v !== undefined; }));\n        return _this;\n    }\n    return RepetitionMandatory;\n}(AbstractProduction));\nexports.RepetitionMandatory = RepetitionMandatory;\nvar RepetitionMandatoryWithSeparator = /** @class */ (function (_super) {\n    __extends(RepetitionMandatoryWithSeparator, _super);\n    function RepetitionMandatoryWithSeparator(options) {\n        var _this = _super.call(this, options.definition) || this;\n        _this.idx = 1;\n        (0, assign_1.default)(_this, (0, pickBy_1.default)(options, function (v) { return v !== undefined; }));\n        return _this;\n    }\n    return RepetitionMandatoryWithSeparator;\n}(AbstractProduction));\nexports.RepetitionMandatoryWithSeparator = RepetitionMandatoryWithSeparator;\nvar Repetition = /** @class */ (function (_super) {\n    __extends(Repetition, _super);\n    function Repetition(options) {\n        var _this = _super.call(this, options.definition) || this;\n        _this.idx = 1;\n        (0, assign_1.default)(_this, (0, pickBy_1.default)(options, function (v) { return v !== undefined; }));\n        return _this;\n    }\n    return Repetition;\n}(AbstractProduction));\nexports.Repetition = Repetition;\nvar RepetitionWithSeparator = /** @class */ (function (_super) {\n    __extends(RepetitionWithSeparator, _super);\n    function RepetitionWithSeparator(options) {\n        var _this = _super.call(this, options.definition) || this;\n        _this.idx = 1;\n        (0, assign_1.default)(_this, (0, pickBy_1.default)(options, function (v) { return v !== undefined; }));\n        return _this;\n    }\n    return RepetitionWithSeparator;\n}(AbstractProduction));\nexports.RepetitionWithSeparator = RepetitionWithSeparator;\nvar Alternation = /** @class */ (function (_super) {\n    __extends(Alternation, _super);\n    function Alternation(options) {\n        var _this = _super.call(this, options.definition) || this;\n        _this.idx = 1;\n        _this.ignoreAmbiguities = false;\n        _this.hasPredicates = false;\n        (0, assign_1.default)(_this, (0, pickBy_1.default)(options, function (v) { return v !== undefined; }));\n        return _this;\n    }\n    Object.defineProperty(Alternation.prototype, \"definition\", {\n        get: function () {\n            return this._definition;\n        },\n        set: function (value) {\n            this._definition = value;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return Alternation;\n}(AbstractProduction));\nexports.Alternation = Alternation;\nvar Terminal = /** @class */ (function () {\n    function Terminal(options) {\n        this.idx = 1;\n        (0, assign_1.default)(this, (0, pickBy_1.default)(options, function (v) { return v !== undefined; }));\n    }\n    Terminal.prototype.accept = function (visitor) {\n        visitor.visit(this);\n    };\n    return Terminal;\n}());\nexports.Terminal = Terminal;\nfunction serializeGrammar(topRules) {\n    return (0, map_1.default)(topRules, serializeProduction);\n}\nexports.serializeGrammar = serializeGrammar;\nfunction serializeProduction(node) {\n    function convertDefinition(definition) {\n        return (0, map_1.default)(definition, serializeProduction);\n    }\n    /* istanbul ignore else */\n    if (node instanceof NonTerminal) {\n        var serializedNonTerminal = {\n            type: \"NonTerminal\",\n            name: node.nonTerminalName,\n            idx: node.idx\n        };\n        if ((0, isString_1.default)(node.label)) {\n            serializedNonTerminal.label = node.label;\n        }\n        return serializedNonTerminal;\n    }\n    else if (node instanceof Alternative) {\n        return {\n            type: \"Alternative\",\n            definition: convertDefinition(node.definition)\n        };\n    }\n    else if (node instanceof Option) {\n        return {\n            type: \"Option\",\n            idx: node.idx,\n            definition: convertDefinition(node.definition)\n        };\n    }\n    else if (node instanceof RepetitionMandatory) {\n        return {\n            type: \"RepetitionMandatory\",\n            idx: node.idx,\n            definition: convertDefinition(node.definition)\n        };\n    }\n    else if (node instanceof RepetitionMandatoryWithSeparator) {\n        return {\n            type: \"RepetitionMandatoryWithSeparator\",\n            idx: node.idx,\n            separator: (serializeProduction(new Terminal({ terminalType: node.separator }))),\n            definition: convertDefinition(node.definition)\n        };\n    }\n    else if (node instanceof RepetitionWithSeparator) {\n        return {\n            type: \"RepetitionWithSeparator\",\n            idx: node.idx,\n            separator: (serializeProduction(new Terminal({ terminalType: node.separator }))),\n            definition: convertDefinition(node.definition)\n        };\n    }\n    else if (node instanceof Repetition) {\n        return {\n            type: \"Repetition\",\n            idx: node.idx,\n            definition: convertDefinition(node.definition)\n        };\n    }\n    else if (node instanceof Alternation) {\n        return {\n            type: \"Alternation\",\n            idx: node.idx,\n            definition: convertDefinition(node.definition)\n        };\n    }\n    else if (node instanceof Terminal) {\n        var serializedTerminal = {\n            type: \"Terminal\",\n            name: node.terminalType.name,\n            label: tokenLabel(node.terminalType),\n            idx: node.idx\n        };\n        if ((0, isString_1.default)(node.label)) {\n            serializedTerminal.terminalLabel = node.label;\n        }\n        var pattern = node.terminalType.PATTERN;\n        if (node.terminalType.PATTERN) {\n            serializedTerminal.pattern = (0, isRegExp_1.default)(pattern)\n                ? pattern.source\n                : pattern;\n        }\n        return serializedTerminal;\n    }\n    else if (node instanceof Rule) {\n        return {\n            type: \"Rule\",\n            name: node.name,\n            orgText: node.orgText,\n            definition: convertDefinition(node.definition)\n        };\n    }\n    else {\n        throw Error(\"non exhaustive match\");\n    }\n}\nexports.serializeProduction = serializeProduction;\n//# sourceMappingURL=model.js.map"]},"metadata":{},"sourceType":"script"}